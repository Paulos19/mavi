generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SupportTicket {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  whatsapp_number String // O @index foi removido daqui
  nome_cliente    String?
  tipo_problema   FlowType
  status          TicketStatus @default(PENDENTE)

  // == ARQUIVOS (Armazenaremos as URLs) ==
  comprovante_entrega   String?
  receita_atual         String?
  receita_antiga        String?
  foto_com_oculos       String?
  comprovante_pagamento String?

  // == DADOS COLETADOS NOS FLUXOS ==
  data_entrega    DateTime?
  tempo_uso       Int?
  sintomas        String?
  endereco_envio  String?
  codigo_rastreio String?

  // Define o índice para o campo whatsapp_number no nível do modelo
  @@index([whatsapp_number])
}

model Notification {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  motivo    String // Ex: "Possível dificuldade de leitura"
  whatsapp_number String
  isRead    Boolean  @default(false)

  @@index([isRead, createdAt])
}

// Enum baseado nos 4 fluxos principais do Escopo Técnico
enum FlowType {
  ADAPTACAO
  QUEBROU_MAREOU
  NAO_BUSCOU
  ENVIO_LABORATORIO
  OUTRO
}

// Status do ticket de suporte
enum TicketStatus {
  PENDENTE
  EM_ANALISE
  AGUARDANDO_CLIENTE
  AGUARDANDO_ENVIO
  CONCLUIDO
}