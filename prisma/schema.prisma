// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Patient {
  id            String          @id @default(cuid())
  nomeCompleto  String
  cidade        String?
  whatsappNumber String          @unique
  tickets       SupportTicket[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model SupportTicket {
  id                  String   @id @default(cuid())
  patientId           String
  patient             Patient  @relation(fields: [patientId], references: [id])
  
  tipoProblema        TicketType @default(OUTRO)
  status              TicketStatus @default(ABERTO)
  
  // Variáveis dos fluxos
  sintomas            String? // Fluxo 1: Adaptação
  dataEntrega         DateTime? // Fluxo 1: Adaptação
  tempoUsoDias        Int?      // Fluxo 1: Adaptação
  causaProblema       String?   // Fluxo 2: Quebra (mau uso, etc)
  
  // URLs para os arquivos
  comprovanteEntregaUrl String?
  receitaAtualUrl     String?
  fotoComOculosUrl    String?
  fotoOculosQuebradoUrl String?
  
  // Para Fluxo 3 (Não Buscou)
  pagamentoPendente   Boolean  @default(false)
  comprovantePgtoUrl  String?
  enderecoEnvio       String?
  codigoRastreio      String?
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

enum TicketType {
  ADAPTACAO
  QUEBRA_MAREOU
  NAO_BUSCOU_ENTREGA
  ENVIO_LAB
  OUTRO
}

enum TicketStatus {
  ABERTO
  EM_ANALISE_LAB
  AGUARDANDO_PAGAMENTO
  EM_TRANSPORTE
  RESOLVIDO
  CANCELADO
}